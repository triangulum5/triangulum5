{{ config(materialized='view') }}

SELECT
  id,
  customer_id,
  shipping_address_id,
  email,
  age,
  brand,
  brand_bra_band_size,
  brand_bra_cup_size,
  brand_dress_size,
  brand_jeans_size,
  body_type,
  shoulders,
  waist,
  torso,
  hips,
  girl_crush,
  height,
  profession,
  job_title,
  looks,
  maternity,
  pierced_ears,
  opinion_on_black,
  price_philosophy,
  weekday_style,
  work_fit,
  primarily_looking,
  primarily_looking_detail,
  requested_delivery_date,
  notes,
  referrer,
  referrer_detail,
  promo_code,
  gift_card,
  created_at,
  updated_at
FROM (
  SELECT
    id,
    customer_id,
    shipping_address_id,
    email,
    age,
    brand,
    brand_bra_band_size,
    brand_bra_cup_size,
    brand_dress_size,
    brand_jeans_size,
    body_type,
    shoulders,
    waist,
    torso,
    hips,
    girl_crush,
    height,
    profession,
    job_title,
    looks,
    maternity,
    pierced_ears,
    opinion_on_black,
    price_philosophy,
    weekday_style,
    work_fit,
    primarily_looking,
    primarily_looking_detail,
    requested_delivery_date,
    notes,
    referrer,
    referrer_detail,
    promo_code,
    gift_card,
    created_at,
    updated_at,
    ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY created_at DESC) row_num
  FROM
    `warehouse-152021.website.mmlafleur_bento_survey`
  WHERE
    customer_id IS NOT NULL)
WHERE
  row_num = 1
